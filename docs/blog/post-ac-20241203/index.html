<!DOCTYPE html>
<html lang="ja"><head>
  <meta charset="utf-8">
  <title>NUTMEG | 長岡技術科学大学 技大祭実行委員会 情報局</title>

  <!-- mobile responsive meta -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="皆様こんにちは。NUTMEG三年目の比嘉華です。アドカレ3日目になります。まだ序の章でありますが是非ご一読ください。 私たちがBingoプロダクトの運用を始めて2年が経ちました。コードに関してはある程度の完成系が見えており、これからはインフラ関連で安定したサービスを目指しています。本ブログでは、Bingoプロダクトで使用しているバックエンドツールであるHasura Engine v2の概要と構成の一例を共有します。Hasura自体の日本語記事が少ない &#43; 私自身のHasuraの復習も兼ねて書いています。この構成が絶対的な正解というわけではありませんので、より良い方法があればぜひ教えてください。">
  <meta name="author" content="NUTMEG">
  <meta name="generator" content="Hugo 0.127.0">

  <!-- plugins -->
  
  <link rel="stylesheet" href="https://blog.nutmeg.cloud/plugins/bootstrap/bootstrap.min.css ">
  
  <link rel="stylesheet" href="https://blog.nutmeg.cloud/plugins/slick/slick.css ">
  
  <link rel="stylesheet" href="https://blog.nutmeg.cloud/plugins/themify-icons/themify-icons.css ">
  
  <link rel="stylesheet" href="https://blog.nutmeg.cloud/plugins/venobox/venobox.css ">
  

  <!-- Main Stylesheet -->
  
  <link rel="stylesheet" href="https://blog.nutmeg.cloud/scss/style.min.css" media="screen">

  <!--Favicon-->
  <link rel="shortcut icon" href="https://blog.nutmeg.cloud/images/favicon.png " type="image/x-icon">
  <link rel="icon" href="https://blog.nutmeg.cloud/images/favicon.png " type="image/x-icon">

  
  <link rel="stylesheet" href="https://blog.nutmeg.cloud/css/custom_post.css">
  

  <meta property="og:url" content="https://blog.nutmeg.cloud/blog/post-ac-20241203/">
  <meta property="og:site_name" content="NUTMEG | 長岡技術科学大学 技大祭実行委員会 情報局">
  <meta property="og:title" content="hasura v2のすゝめ">
  <meta property="og:description" content="皆様こんにちは。NUTMEG三年目の比嘉華です。アドカレ3日目になります。まだ序の章でありますが是非ご一読ください。 私たちがBingoプロダクトの運用を始めて2年が経ちました。コードに関してはある程度の完成系が見えており、これからはインフラ関連で安定したサービスを目指しています。本ブログでは、Bingoプロダクトで使用しているバックエンドツールであるHasura Engine v2の概要と構成の一例を共有します。Hasura自体の日本語記事が少ない &#43; 私自身のHasuraの復習も兼ねて書いています。この構成が絶対的な正解というわけではありませんので、より良い方法があればぜひ教えてください。">
  <meta property="og:locale" content="ja">
  <meta property="og:type" content="article">
    <meta property="article:section" content="blog">
    <meta property="article:published_time" content="2024-12-03T11:01:12+09:00">
    <meta property="article:modified_time" content="2024-12-03T11:01:12+09:00">
    <meta property="article:tag" content="TypeScript">
    <meta property="article:tag" content="Next.js">
    <meta property="article:tag" content="Docker">
    <meta property="article:tag" content="Hasura">
    <meta property="article:tag" content="バックエンド">
    <meta property="article:tag" content="API関係">
    <meta property="og:image" content="https://blog.nutmeg.cloud/images/OGP.png">

  
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="https://blog.nutmeg.cloud/images/OGP.png">
  <meta name="twitter:title" content="hasura v2のすゝめ">
  <meta name="twitter:description" content="皆様こんにちは。NUTMEG三年目の比嘉華です。アドカレ3日目になります。まだ序の章でありますが是非ご一読ください。 私たちがBingoプロダクトの運用を始めて2年が経ちました。コードに関してはある程度の完成系が見えており、これからはインフラ関連で安定したサービスを目指しています。本ブログでは、Bingoプロダクトで使用しているバックエンドツールであるHasura Engine v2の概要と構成の一例を共有します。Hasura自体の日本語記事が少ない &#43; 私自身のHasuraの復習も兼ねて書いています。この構成が絶対的な正解というわけではありませんので、より良い方法があればぜひ教えてください。">


  <!-- google analitycs -->
  <script>
    (function (i, s, o, g, r, a, m) {
      i['GoogleAnalyticsObject'] = r;
      i[r] = i[r] || function () {
        (i[r].q = i[r].q || []).push(arguments)
      }, i[r].l = 1 * new Date();
      a = s.createElement(o),
        m = s.getElementsByTagName(o)[0];
      a.async = 1;
      a.src = g;
      m.parentNode.insertBefore(a, m)
    })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');
    ga('create', 'Your ID', 'auto');
    ga('send', 'pageview');
  </script>

  
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-Q71WVEHHBF"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

  gtag('config', 'G-Q71WVEHHBF');
  </script>
</head>
<body>
<!-- preloader start -->
<div class="preloader">
  
</div>
<!-- preloader end -->
<!-- navigation -->
<header class="navigation">
  <div class="container">
    
    <nav class="navbar navbar-expand-lg navbar-white bg-transparent border-bottom pl-0">
      <a class="navbar-brand mobile-view" href="https://blog.nutmeg.cloud/"><img class="img-fluid"
          src="https://blog.nutmeg.cloud/images/NUTMEG-logo_all_color_horizontal.png" alt="NUTMEG | 長岡技術科学大学 技大祭実行委員会 情報局"></a>
      <button class="navbar-toggler border-0" type="button" data-toggle="collapse" data-target="#navigation">
        <i class="ti-menu h3"></i>
      </button>

      <div class="collapse navbar-collapse text-center" id="navigation">
        <div class="desktop-view">
          <ul class="navbar-nav mr-auto">
            
            <li class="nav-item">
              <a class="nav-link" href="https://twitter.com/nutfes_nutmeg"><i class="ti-twitter-alt"></i></a>
            </li>
            
            <li class="nav-item">
              <a class="nav-link" href="https://www.instagram.com/nutfes/?hl=ja"><i class="ti-instagram"></i></a>
            </li>
            
            <li class="nav-item">
              <a class="nav-link" href="https://github.com/orgs/NUTFes"><i class="ti-github"></i></a>
            </li>
            
          </ul>
        </div>

        <a class="navbar-brand mx-auto desktop-view" href="https://blog.nutmeg.cloud/"><img class="img-fluid"
            src="https://blog.nutmeg.cloud/images/NUTMEG-logo_all_color_horizontal.png" alt="NUTMEG | 長岡技術科学大学 技大祭実行委員会 情報局"></a>

        <ul class="navbar-nav">
          
          
          <li class="nav-item">
            <a class="nav-link" href="https://blog.nutmeg.cloud/about">About</a>
          </li>
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="https://blog.nutmeg.cloud/blog">Post</a>
          </li>
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="https://blog.nutmeg.cloud/products">Products</a>
          </li>
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="https://blog.nutmeg.cloud/members">Members</a>
          </li>
          
          
        </ul>

        
        <!-- search -->
        <div class="search pl-lg-4">
          <button id="searchOpen" class="search-btn"><i class="ti-search"></i></button>
          <div class="search-wrapper">
            <form action="https://blog.nutmeg.cloud//search" class="h-100">
              <input class="search-box px-4" id="search-query" name="s" type="search" placeholder="Type & Hit Enter...">
            </form>
            <button id="searchClose" class="search-close"><i class="ti-close text-dark"></i></button>
          </div>
        </div>
        

        
      </div>
    </nav>
  </div>
</header>
<!-- /navigation -->

<section class="section-sm">
  <div class="container">
    <div class="row">
      <div class="col-lg-8 mx-auto">
        
        <a href="https://blog.nutmeg.cloud/categories/nutmeg-advent-calendar-2024"
          class="text-primary">Nutmeg advent calendar 2024</a>
        
        <a href="https://blog.nutmeg.cloud/categories/%e3%83%a1%e3%83%b3%e3%83%90%e3%83%bc%e3%81%ae%e8%b6%a3%e5%91%b3"
          class="text-primary">メンバーの趣味</a>
        
        <a href="https://blog.nutmeg.cloud/categories/%e6%b4%bb%e5%8b%95%e3%81%ae%e6%a7%98%e5%ad%90"
          class="text-primary">活動の様子</a>
        
        <h2>hasura v2のすゝめ</h2>
        <div class="mb-3 post-meta">
          <span class="author">
            
            
            <p>
              
              
              By 比嘉華
              
              
              
              
              <span class="border-bottom border-primary px-2 mx-1"></span>
              03 December 2024
              
            </p>
          </span>
        </div>
        
        <img src="https://hackmd.io/_uploads/B1A1QhFXyx.png" class="img-fluid w-100 mb-4" alt="hasura v2のすゝめ">
        
        <div class="content mb-5">
          <h2 id="はじめに">はじめに</h2>
<p>皆様こんにちは。NUTMEG 3年目の比嘉華です。アドカレ3日目になります。まだ序の章でありますが是非ご一読ください。
私たちがBingoプロダクトの運用を始めて2年が経ちました。コードに関してはある程度の完成系が見えており、これからはインフラ関連で安定したサービスを目指しています。本ブログでは、Bingoプロダクトで使用しているバックエンドツールであるHasura Engine v2の概要と構成の一例を共有します。<strong>Hasura自体の日本語記事が少ない + 私自身のHasuraの復習も兼ねて書いています。この構成が絶対的な正解というわけではありませんので、より良い方法があればぜひ教えてください。</strong></p>
<h2 id="hasura-graphql-engineとは">Hasura GraphQL Engineとは</h2>
<p>以下は<a href="https://hasura.io/docs/2.0/index/">公式ドキュメント</a>の翻訳です。
Hasura GraphQL Engineは、データを即座にGraphQL APIとして利用可能にし、モダンで高性能なアプリケーションやAPIを従来の10倍の速さで構築・提供できるオープンソースのエンジンです。Hasuraはデータベース、RESTおよびGraphQLエンドポイント、サードパーティAPIに接続し、すべてのデータに対して統合されたリアルタイムでセキュアなGraphQL APIを提供します。Hasuraのコア機能はオープンソースで開発されており、誰でも無料で使用できます。</p>
<p>要するに、Hasura Engine（以下、Hasura）は、PostgreSQLサーバーから自動的にGraphQLサーバーを構築できるツールです。Hasuraを使用する際は、HasuraとPostgreSQLを組み合わせて利用するようにしましょう。なお、<em><strong>「Hasura」は「阿修羅（Ashura）」とHaskellを組み合わせた造語です。</strong></em></p>
<p>Hasuraが自動でGraphQLサーバーとして動作するため、GraphQLサーバーを実装する手間が省けます。Hasuraで設定すれば、すぐにQuery、Mutation、Subscriptionを使えるため、高い開発効率で開発を進めることができます。Hasuraのコンソールでテーブルを作成し、クエリに沿ったコードをGraphQL Code Generatorで自動生成できるので、バックエンドの実装を簡単に行うことができます。</p>
<p>また、HasuraではAuth0などの認証プロバイダと通信し、JWTを利用して、各テーブルやカラムに対して、ユーザーのロールやIDに基づく詳細なアクセス権限を設定できます。JWTに含まれる <code>X-Hasura-User-Id</code> を使用して、特定のユーザーが自身のデータのみを取得・操作できるように制限することが可能です。</p>
<h2 id="hasuraの環境構築">Hasuraの環境構築</h2>
<p>Docker環境でのHasuraの環境構築を紹介します。この手順を踏むことで、バックエンドをすべてHasuraに一任できるでしょう。</p>
<p>Bingoプロダクトから必要なものだけを抽出して簡素化しているため、フロントエンドはあまり参考にしないでください。本来は、App Routerの使用やpnpmでの管理などを行った方が良いと思います！</p>
<p>本構成の特徴は、<code>docker compose build</code>が不要になることです。ただし、使い勝手は正直あまり良くありません。起動のたびに<code>npm ci、npm run</code>が実行されるため、コンテナ起動から実際のアプリケーション起動まで約1分かかります。</p>
<h3 id="最終的なディレクトリ構成-appは触った部分のみを掲載">最終的なディレクトリ構成 ※appは触った部分のみを掲載</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-zsh" data-lang="zsh"><span class="line"><span class="cl">📁api
</span></span><span class="line"><span class="cl">    📁metadata
</span></span><span class="line"><span class="cl">    📁migrations/default/hoge_auto
</span></span><span class="line"><span class="cl">        📄up.sql
</span></span><span class="line"><span class="cl">    📁seed
</span></span><span class="line"><span class="cl">    📄config.yaml
</span></span><span class="line"><span class="cl">📁app
</span></span><span class="line"><span class="cl">    📁src
</span></span><span class="line"><span class="cl">        📁gql
</span></span><span class="line"><span class="cl">            📄users.gql
</span></span><span class="line"><span class="cl">        📁pages
</span></span><span class="line"><span class="cl">            📄_app.tsx
</span></span><span class="line"><span class="cl">            📄index.tsx
</span></span><span class="line"><span class="cl">        📁type
</span></span><span class="line"><span class="cl">            📄graphql.ts
</span></span><span class="line"><span class="cl">    📄.eslintrc.json
</span></span><span class="line"><span class="cl">    📄next.config.ts
</span></span><span class="line"><span class="cl">    📄codegen.ts
</span></span><span class="line"><span class="cl">📁settings
</span></span><span class="line"><span class="cl">    📄.env
</span></span><span class="line"><span class="cl">📄compose.yaml
</span></span><span class="line"><span class="cl">📄.gitignore
</span></span><span class="line"><span class="cl">📄Makefile</span></span></code></pre></div>
<p><a href="https://github.com/hikahana/hasura_v3">Githubに挙げたものはこちらです。</a></p>
<p>GitHub上のリポジトリ作成とfirst commitは完了している前提で進めます。リポジトリの作成について不明な方は、<a href="https://docs.github.com/ja/repositories/creating-and-managing-repositories/creating-a-new-repository">公式ドキュメント</a>を参照してください。</p>
<h3 id="1-compose-upするための準備">1. compose upするための準備</h3>
<p>1.1
まず、compose.yamlを作成し、使用するコンテナの情報を定義します。フロントエンドはNextjs、バックエンドはHasura、データベースはPostgreSQLを使用するため、これらを定義します。</p>
<p>(以下、compose.yamlの内容)</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">services</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">db</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">postgres:12</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;db&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="s2">&#34;5432:5432&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">db-data:/var/lib/postgresql/data</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">environment</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">POSTGRES_DB</span><span class="p">:</span><span class="w"> </span><span class="l">db</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">POSTGRES_USER</span><span class="p">:</span><span class="w"> </span><span class="l">user</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">POSTGRES_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="l">password</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">POSTGRES_HOST_AUTH_METHOD</span><span class="p">:</span><span class="w"> </span><span class="l">trust</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">healthcheck</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">test</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="s2">&#34;CMD-SHELL&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="s2">&#34;pg_isready&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">interval</span><span class="p">:</span><span class="w"> </span><span class="l">10s</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">timeout</span><span class="p">:</span><span class="w"> </span><span class="l">5s</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">retries</span><span class="p">:</span><span class="w"> </span><span class="m">5</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">api</span><span class="p">:</span><span class="w"> </span><span class="c"># hasura</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">hasura/graphql-engine:v2.36.6@sha256:3fc234510962e66d5ca7db16734b8796a16fb729953915861953e974f976f30f</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;api&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="s2">&#34;8080:8080&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">./api:/hasura/api</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">working_dir</span><span class="p">:</span><span class="w"> </span><span class="l">/hasura/api</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">env_file</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">./settings/.env</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">entrypoint</span><span class="p">:</span><span class="w"> </span><span class="p">&gt;</span><span class="sd">
</span></span></span><span class="line"><span class="cl"><span class="sd">      sh -c &#34;
</span></span></span><span class="line"><span class="cl"><span class="sd">      curl -L https://github.com/hasura/graphql-engine/raw/stable/cli/get.sh | bash &amp;&amp;
</span></span></span><span class="line"><span class="cl"><span class="sd">      graphql-engine serve
</span></span></span><span class="line"><span class="cl"><span class="sd">      &#34;</span><span class="w">      
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">app</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">node:20-alpine@sha256:b5b9467fe7b33aad47f1ec3f6e0646a658f85f05c18d4243024212a91f3b7554</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;app&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">./app:/app</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">working_dir</span><span class="p">:</span><span class="w"> </span><span class="l">/app</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l">sh -c &#34;npm ci &amp;&amp; npm run dev&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="s2">&#34;3000:3000&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">env_file</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">./settings/.env</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">stdin_open</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">tty</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">db-data</span><span class="p">:</span><span class="w">
</span></span></span></code></pre></div><hr>
<p>1.2
環境変数を配置するため、設定を行います。compose.yamlを確認すると、apiとappの環境変数は<code>settings/.env</code>を参照していることがわかります。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># ルートディレクトリ直下で</span>
</span></span><span class="line"><span class="cl">mkdir settings
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> settings
</span></span><span class="line"><span class="cl">touch .env
</span></span></code></pre></div><p>.envファイルの内容は以下の通りです。
(以下、.envの内容)</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-env" data-lang="env"><span class="line"><span class="cl"><span class="nv">NEXT_PUBLIC_CSR_API_URL</span><span class="o">=</span><span class="s2">&#34;http://localhost:8080&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">NEXT_PUBLIC_SSR_API_URL</span><span class="o">=</span><span class="s2">&#34;http://api:8080&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">NEXT_PUBLIC_BASE_URL</span><span class="o">=</span><span class="s2">&#34;http://localhost:8080&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">API_URI</span><span class="o">=</span><span class="s2">&#34;http://localhost:8080&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">WATCHPACK_POLLING</span><span class="o">=</span><span class="s2">&#34;true&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">WS_API_URL</span><span class="o">=</span><span class="s2">&#34;ws://localhost:8080&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">HASURA_GRAPHQL_ENABLE_CONSOLE</span><span class="o">=</span><span class="s2">&#34;true&#34;</span>
</span></span><span class="line"><span class="cl"><span class="c1"># &#34;postgres://{db_user_name}:{db_user_password}@{seivice_name}:{db_port}/{db_name}&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">HASURA_GRAPHQL_DATABASE_URL</span><span class="o">=</span><span class="s2">&#34;postgres://user:password@db:5432/db&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">HASURA_GRAPHQL_DEV_MODE</span><span class="o">=</span><span class="s2">&#34;true&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">HASURA_GRAPHQL_ENABLED_LOG_TYPES</span><span class="o">=</span><span class="s2">&#34;startup, http-log, webhook-log, websocket-log, query-log&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">HASURA_GRAPHQL_EXPERIMENTAL_FEATURES</span><span class="o">=</span><span class="s2">&#34;naming_convention&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">HASURA_GRAPHQL_CLI_ENVIRONMENT</span><span class="o">=</span><span class="s2">&#34;default&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">HASURA_GRAPHQL_ADMIN_SECRET</span><span class="o">=</span><span class="s2">&#34;hogehoge&#34;</span>
</span></span></code></pre></div><p>※注意点
<strong>HASURA_GRAPHQL_DATABASE_URL</strong>はcompose.yamlのdbのenviromentで定義したものと同一にしてください。そうでないとdbへのアクセスができません。
<strong>HASURA_GRAPHQL_ADMIN_SECRET</strong>は適宜修正してください。</p>
<hr>
<p>1.3
gitに環境変数ファイルをアップロードしないよう、.gitignoreファイルを作成します。</p>
<p>(以下、.gitignoreの内容)</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">settings/
</span></span></code></pre></div><hr>
<p>1.4
Nextjsの環境構築を行います。以下の手順に従ってください。</p>
<p>(以下、Next.jsセットアップの対話型インストール手順)</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">npx create-next-app@latest app
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Need to install the following packages:
</span></span><span class="line"><span class="cl">  create-next-app@15.0.3
</span></span><span class="line"><span class="cl">Ok to proceed? <span class="o">(</span>y<span class="o">)</span> y
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">✔ Would you like to use TypeScript? … No / Yes
</span></span><span class="line"><span class="cl">✔ Would you like to use ESLint? … No / Yes
</span></span><span class="line"><span class="cl">✔ Would you like to use Tailwind CSS? … No / Yes
</span></span><span class="line"><span class="cl">✔ Would you like your code inside a <span class="sb">`</span>src/<span class="sb">`</span> directory? … No / Yes
</span></span><span class="line"><span class="cl">✔ Would you like to use App Router? <span class="o">(</span>recommended<span class="o">)</span> … No / Yes
</span></span><span class="line"><span class="cl">✔ Would you like to use Turbopack <span class="k">for</span> next dev? … No / Yes
</span></span><span class="line"><span class="cl">✔ Would you like to customize the import <span class="nb">alias</span> <span class="o">(</span>@/* by default<span class="o">)</span>? … No / Yes
</span></span><span class="line"><span class="cl">✔ What import <span class="nb">alias</span> would you like configured? … @/*
</span></span></code></pre></div><hr>
<p>1.5
最後に、Makefileを作成します。これは後のHasura操作で使用します。</p>
<p>(以下、Makefileの内容)</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-makefile" data-lang="makefile"><span class="line"><span class="cl"><span class="nf">run</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">	docker compose up -d
</span></span><span class="line"><span class="cl">	sleep <span class="m">10</span>
</span></span><span class="line"><span class="cl">	make db-apply
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">down</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">	docker compose down
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">db/apply</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">	docker compose <span class="nb">exec</span> api hasura metadata apply
</span></span><span class="line"><span class="cl">	docker compose <span class="nb">exec</span> api hasura migrate apply --database-name default
</span></span><span class="line"><span class="cl">	docker compose <span class="nb">exec</span> api hasura metadata reload
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">db/export</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">	docker compose <span class="nb">exec</span> api hasura metadata <span class="nb">export</span>
</span></span><span class="line"><span class="cl">	docker compose <span class="nb">exec</span> api hasura migrate create <span class="s2">&#34;auto&#34;</span> --from-server --database-name default
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">db/seed</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">	docker compose <span class="nb">exec</span> api hasura seed apply
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">codegen</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">	docker compose run --rm app npm run codegen
</span></span></code></pre></div><h3 id="2-hasuraの起動">2. Hasuraの起動</h3>
<p>2.1
compose up前に必要な準備が整ったので、実際にコンテナを立ち上げ、Hasuraの初期起動を行います。</p>
<p>Hasura CLIを使用してHasuraの環境を作成します。今回はコンテナ内でインストールするため、<code>docker compose run --rm</code>ではうまく動作しません。</p>
<p><code>hasura init --directory .</code>で初期化の場所を指定できます。今回はcompose upの際にapiフォルダが作成されているため、そこに初期化させます。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">docker compose up -d
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">docker compose <span class="nb">exec</span> api hasura init --directory .
</span></span></code></pre></div><hr>
<p>2.2
初期化が成功したら、<code>localhost:8080/console</code>にアクセスしてusersスキーマを作成します。アクセスする際は、.envファイルで設定したADMIN_SECRETが適用されます。</p>
<p>画面上部のヘッダーから<strong>DATA</strong>をクリックし、その後「Create table」をクリックします。以下の画像を参考に、usersスキーマを作成してください。created_atとupdated_atは、「Frequently used columns」から選択できます。
<img src="https://hackmd.io/_uploads/HyzL_ntXJg.png" alt="image (2)">
<img src="https://hackmd.io/_uploads/BkO8d2KX1g.jpg" alt="Add Table - Data _ Hasura_page-0001">
<img src="https://hackmd.io/_uploads/SJ0LOnYXJe.png" alt="image (3)"></p>
<hr>
<p>2.3
スキーマの作成が完了したら、データベースの移行と現在のスキーマのエクスポートを行います。先ほど作成したMakeコマンドを実行します。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">make db/export
</span></span><span class="line"><span class="cl">make db/apply
</span></span></code></pre></div><h3 id="3-graphql-code-generatorの導入">3. GraphQL Code Generatorの導入</h3>
<p>3.1
HasuraとNext.jsの環境が整ったので、最後にCode Generatorで自動生成できるように設定します。</p>
<p>必要なプラグインをインストールします。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">docker compose run --rm app npm install --save-dev <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  @graphql-codegen/cli <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  graphql <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  @graphql-codegen/client-preset <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  @graphql-codegen/typescript <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  @graphql-codegen/typescript-graphql-request <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  @graphql-codegen/typescript-operations <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  @graphql-codegen/typescript-react-apollo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  prettier
</span></span></code></pre></div><hr>
<p>3.2
次に、Code Generatorの設定ファイルを作成します。対話型のセットアップ手順に従い、以下のように設定ファイルを修正します。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">docker compose run app npx graphql-codegen init
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    Welcome to GraphQL Code Generator!
</span></span><span class="line"><span class="cl">    Answer few questions and we will setup everything <span class="k">for</span> you.
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">? What <span class="nb">type</span> of application are you building? Application built with React
</span></span><span class="line"><span class="cl">? Where is your schema?: <span class="o">(</span>path or url<span class="o">)</span> http:localhost:8080
</span></span><span class="line"><span class="cl">? Where are your operations and fragments?: src/gql/*.gql
</span></span><span class="line"><span class="cl">? Where to write the output: type/
</span></span><span class="line"><span class="cl">? Do you want to generate an introspection file? Yes
</span></span><span class="line"><span class="cl">? How to name the config file? codegen.ts
</span></span><span class="line"><span class="cl">? What script in package.json should run the codegen? codegen
</span></span><span class="line"><span class="cl">Fetching latest versions of selected plugins...
</span></span></code></pre></div><p>init後、以下のように修正してください。
(以下、codegen.tsの内容)</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">config</span> <span class="kr">as</span> <span class="nx">dotenvConfig</span> <span class="p">}</span> <span class="kr">from</span> <span class="s2">&#34;dotenv&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">CodegenConfig</span> <span class="p">}</span> <span class="kr">from</span> <span class="s2">&#34;@graphql-codegen/cli&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">dotenvConfig</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">config</span>: <span class="kt">CodegenConfig</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">overwrite</span>: <span class="kt">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">schema</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;http://api:8080/v1/graphql&#34;</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">headers</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="s2">&#34;x-hasura-admin-secret&#34;</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">            <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">HASURA_GRAPHQL_ADMIN_SECRET</span> <span class="o">||</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="p">],</span>
</span></span><span class="line"><span class="cl">  <span class="nx">documents</span><span class="o">:</span> <span class="s2">&#34;src/gql/*.gql&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">hooks</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">afterAllFileWrite</span><span class="o">:</span> <span class="p">[</span><span class="s2">&#34;prettier --write&#34;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="nx">generates</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;./src/type/graphql.ts&#34;</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">plugins</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;typescript&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;typescript-operations&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;typescript-react-apollo&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="p">],</span>
</span></span><span class="line"><span class="cl">      <span class="nx">config</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">namingConvention</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nx">typeNames</span><span class="o">:</span> <span class="s2">&#34;change-case-all#pascalCase&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nx">enumValues</span><span class="o">:</span> <span class="s2">&#34;change-case-all#camelCase&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nx">fieldNames</span><span class="o">:</span> <span class="s2">&#34;change-case-all#camelCase&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="nx">transformUnderscore</span><span class="o">:</span> <span class="s2">&#34;true&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">gqlImport</span><span class="o">:</span> <span class="s2">&#34;@apollo/client#gql&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">withHooks</span>: <span class="kt">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">withHOC</span>: <span class="kt">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">withComponent</span>: <span class="kt">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="k">default</span> <span class="nx">config</span><span class="p">;</span>
</span></span></code></pre></div><hr>
<p>3.3
GraphQLクエリファイルを作成します。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">mkdir gql
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> gql
</span></span><span class="line"><span class="cl">touch users.gql
</span></span></code></pre></div><p>(以下、users.gqlの内容)</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-gql" data-lang="gql"><span class="line"><span class="cl"><span class="kd">query</span><span class="w"> </span><span class="nc">GetUsers</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="py">users</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="py">id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="py">name</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="py">created_at</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="py">updated_at</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">mutation</span><span class="w"> </span><span class="nc">CreateUser</span><span class="p">(</span><span class="nv">$name</span><span class="p">:</span><span class="w"> </span><span class="nc">String</span><span class="p">!)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="py">insert_users_one</span><span class="p">(</span><span class="py">object</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nc">name</span><span class="p">:</span><span class="w"> </span><span class="nv">$name</span><span class="p">})</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nc">id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="py">name</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">mutation</span><span class="w"> </span><span class="nc">UpdateUser</span><span class="p">(</span><span class="nv">$id</span><span class="p">:</span><span class="w"> </span><span class="nc">Int</span><span class="p">!,</span><span class="w"> </span><span class="nv">$name</span><span class="p">:</span><span class="w"> </span><span class="nc">String</span><span class="p">!)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="py">update_users_by_pk</span><span class="p">(</span><span class="py">pk_columns</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nc">id</span><span class="p">:</span><span class="w"> </span><span class="nv">$id</span><span class="p">},</span><span class="w"> </span><span class="nc">_set</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nc">name</span><span class="p">:</span><span class="w"> </span><span class="nv">$name</span><span class="p">})</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nc">id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="py">name</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">mutation</span><span class="w"> </span><span class="nc">DeleteUser</span><span class="p">(</span><span class="nv">$id</span><span class="p">:</span><span class="w"> </span><span class="nc">Int</span><span class="p">!)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="py">delete_users_by_pk</span><span class="p">(</span><span class="py">id</span><span class="p">:</span><span class="w"> </span><span class="nv">$id</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nc">id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="py">name</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><hr>
<p>3.4
ESLintの設定を修正します。</p>
<p>(以下、.eslintrc.jsonの内容)</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;extends&#34;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&#34;next/core-web-vitals&#34;</span><span class="p">,</span> <span class="s2">&#34;next/typescript&#34;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;overrides&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;files&#34;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&#34;app/src/type/*&#34;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;rules&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;no-unused-vars&#34;</span><span class="p">:</span> <span class="s2">&#34;off&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;other-rule&#34;</span><span class="p">:</span> <span class="s2">&#34;off&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><hr>
<p>3.5
最後に、型定義とカスタムフックを自動生成します。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">make codegen
</span></span></code></pre></div><h3 id="4-動作確認">4. 動作確認</h3>
<p>4.1
src/pagesにある_app.tsxとindex.tsxを修正します。app.tsxでApolloProviderで囲まないとエラーが返ってきてしまうので忘れずに行いましょう。</p>
<p>(以下、_app.tsxの内容)</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-tsx" data-lang="tsx"><span class="line"><span class="cl"><span class="kr">import</span> <span class="s2">&#34;@/styles/globals.css&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="kr">type</span> <span class="p">{</span> <span class="nx">AppProps</span> <span class="p">}</span> <span class="kr">from</span> <span class="s2">&#34;next/app&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">ApolloProvider</span><span class="p">,</span> <span class="nx">ApolloClient</span><span class="p">,</span> <span class="nx">InMemoryCache</span> <span class="p">}</span> <span class="kr">from</span> <span class="s2">&#34;@apollo/client&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">GraphQLWsLink</span> <span class="p">}</span> <span class="kr">from</span> <span class="s2">&#34;@apollo/client/link/subscriptions&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">createClient</span> <span class="p">}</span> <span class="kr">from</span> <span class="s2">&#34;graphql-ws&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">wsClient</span> <span class="o">=</span> <span class="nx">createClient</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">  <span class="nx">url</span>: <span class="kt">process.env.WS_API_URL</span> <span class="o">+</span> <span class="s2">&#34;/v1/graphql&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">connectionParams</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">headers</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;x-hasura-admin-secret&#34;</span><span class="o">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">HASURA_GRAPHQL_ADMIN_SECRET</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="c1">// ヘッダーを含んだ websocket リンクを作成
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span> <span class="nx">wsLink</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">GraphQLWsLink</span><span class="p">(</span><span class="nx">wsClient</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Apollo client を作成
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span> <span class="nx">client</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ApolloClient</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">  <span class="nx">link</span>: <span class="kt">wsLink</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">cache</span>: <span class="kt">new</span> <span class="nx">InMemoryCache</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="k">default</span> <span class="kd">function</span> <span class="nx">App</span><span class="p">({</span> <span class="nx">Component</span><span class="p">,</span> <span class="nx">pageProps</span> <span class="p">}</span><span class="o">:</span> <span class="nx">AppProps</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">ApolloProvider</span> <span class="na">client</span><span class="o">=</span><span class="p">{</span><span class="nx">client</span><span class="p">}&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">Component</span> <span class="p">{</span><span class="na">...pageProps</span><span class="p">}</span> <span class="p">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;/</span><span class="nt">ApolloProvider</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>(以下、index.tsxの内容)</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-tsx" data-lang="tsx"><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">useSubscription</span><span class="p">,</span> <span class="nx">useMutation</span> <span class="p">}</span> <span class="kr">from</span> <span class="s2">&#34;@apollo/client&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">SubscriptionUsersSubscription</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">CreateUserMutation</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">UpdateUserMutation</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">DeleteUserMutation</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">SubscriptionUsersDocument</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">CreateUserDocument</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">UpdateUserDocument</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">DeleteUserDocument</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="kr">from</span> <span class="s2">&#34;@/type/graphql&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">useState</span> <span class="p">}</span> <span class="kr">from</span> <span class="s2">&#34;react&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">Page</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="p">{</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">loading</span><span class="p">,</span> <span class="nx">error</span> <span class="p">}</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">    <span class="nx">useSubscription</span><span class="p">&lt;</span><span class="nt">SubscriptionUsersSubscription</span><span class="p">&gt;(</span><span class="nx">SubscriptionUsersDocument</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="p">[</span><span class="nx">createUser</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useMutation</span><span class="p">&lt;</span><span class="nt">CreateUserMutation</span><span class="p">&gt;(</span><span class="nx">CreateUserDocument</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="p">[</span><span class="nx">updateUser</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useMutation</span><span class="p">&lt;</span><span class="nt">UpdateUserMutation</span><span class="p">&gt;(</span><span class="nx">UpdateUserDocument</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="p">[</span><span class="nx">deleteUser</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useMutation</span><span class="p">&lt;</span><span class="nt">DeleteUserMutation</span><span class="p">&gt;(</span><span class="nx">DeleteUserDocument</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="p">[</span><span class="nx">newName</span><span class="p">,</span> <span class="nx">setNewName</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">&lt;</span><span class="nt">string</span><span class="p">&gt;(</span><span class="s2">&#34;&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="p">[</span><span class="nx">editId</span><span class="p">,</span> <span class="nx">setEditId</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">&lt;</span><span class="nt">number</span> <span class="err">|</span> <span class="na">null</span><span class="p">&gt;(</span><span class="kc">null</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="p">[</span><span class="nx">editName</span><span class="p">,</span> <span class="nx">setEditName</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">&lt;</span><span class="nt">string</span><span class="p">&gt;(</span><span class="s2">&#34;&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">handleCreateUser</span> <span class="o">=</span> <span class="kr">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">newName</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">await</span> <span class="nx">createUser</span><span class="p">({</span> <span class="nx">variables</span><span class="o">:</span> <span class="p">{</span> <span class="nx">name</span>: <span class="kt">newName</span> <span class="p">}</span> <span class="p">});</span>
</span></span><span class="line"><span class="cl">      <span class="nx">setNewName</span><span class="p">(</span><span class="s2">&#34;&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">&#34;Error creating user:&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">handleEdit</span> <span class="o">=</span> <span class="p">(</span><span class="nx">id</span>: <span class="kt">number</span><span class="p">,</span> <span class="nx">name</span>: <span class="kt">string</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">setEditId</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">setEditName</span><span class="p">(</span><span class="nx">name</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">handleUpdateUser</span> <span class="o">=</span> <span class="kr">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">editId</span> <span class="o">===</span> <span class="kc">null</span> <span class="o">||</span> <span class="o">!</span><span class="nx">editName</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">await</span> <span class="nx">updateUser</span><span class="p">({</span> <span class="nx">variables</span><span class="o">:</span> <span class="p">{</span> <span class="nx">id</span>: <span class="kt">editId</span><span class="p">,</span> <span class="nx">name</span>: <span class="kt">editName</span> <span class="p">}</span> <span class="p">});</span>
</span></span><span class="line"><span class="cl">      <span class="nx">setEditId</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="nx">setEditName</span><span class="p">(</span><span class="s2">&#34;&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">&#34;Error updating user:&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">handleDeleteUser</span> <span class="o">=</span> <span class="kr">async</span> <span class="p">(</span><span class="nx">id</span>: <span class="kt">number</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">await</span> <span class="nx">deleteUser</span><span class="p">({</span> <span class="nx">variables</span><span class="o">:</span> <span class="p">{</span> <span class="nx">id</span> <span class="p">}</span> <span class="p">});</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">&#34;Error deleting user:&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="nx">loading</span><span class="p">)</span> <span class="k">return</span> <span class="p">&lt;&gt;</span><span class="nx">loading</span><span class="p">...&lt;/&gt;;</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="k">return</span> <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span><span class="nb">Error</span><span class="o">:</span> <span class="p">{</span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="p">}&lt;/</span><span class="nt">p</span><span class="p">&gt;;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span><span class="nx">Users</span><span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">input</span>
</span></span><span class="line"><span class="cl">          <span class="na">type</span><span class="o">=</span><span class="s">&#34;text&#34;</span>
</span></span><span class="line"><span class="cl">          <span class="na">value</span><span class="o">=</span><span class="p">{</span><span class="nx">newName</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">          <span class="na">onChange</span><span class="o">=</span><span class="p">{(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">setNewName</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span><span class="p">)}</span>
</span></span><span class="line"><span class="cl">          <span class="na">placeholder</span><span class="o">=</span><span class="s">&#34;Enter name&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="p">/&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">handleCreateUser</span><span class="p">}&gt;</span><span class="nx">Create</span> <span class="nx">User</span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">ul</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span><span class="nx">data</span><span class="o">?</span><span class="p">.</span><span class="nx">users</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">user</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">          <span class="p">&lt;</span><span class="nt">li</span> <span class="na">key</span><span class="o">=</span><span class="p">{</span><span class="nx">user</span><span class="p">.</span><span class="nx">id</span><span class="p">}&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="p">{</span><span class="nx">editId</span> <span class="o">===</span> <span class="nx">user</span><span class="p">.</span><span class="nx">id</span> <span class="o">?</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">              <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="p">&lt;</span><span class="nt">input</span>
</span></span><span class="line"><span class="cl">                  <span class="na">type</span><span class="o">=</span><span class="s">&#34;text&#34;</span>
</span></span><span class="line"><span class="cl">                  <span class="na">value</span><span class="o">=</span><span class="p">{</span><span class="nx">editName</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">                  <span class="na">onChange</span><span class="o">=</span><span class="p">{(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">setEditName</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span><span class="p">)}</span>
</span></span><span class="line"><span class="cl">                  <span class="na">placeholder</span><span class="o">=</span><span class="s">&#34;Edit name&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="p">/&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">handleUpdateUser</span><span class="p">}&gt;</span><span class="nx">Save</span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick</span><span class="o">=</span><span class="p">{()</span> <span class="o">=&gt;</span> <span class="nx">setEditId</span><span class="p">(</span><span class="kc">null</span><span class="p">)}&gt;</span><span class="nx">Cancel</span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">              <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="p">)</span> <span class="o">:</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">              <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;{</span><span class="nx">user</span><span class="p">.</span><span class="nx">name</span><span class="p">}&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick</span><span class="o">=</span><span class="p">{()</span> <span class="o">=&gt;</span> <span class="nx">handleEdit</span><span class="p">(</span><span class="nx">user</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="nx">user</span><span class="p">.</span><span class="nx">name</span><span class="p">)}&gt;</span>
</span></span><span class="line"><span class="cl">                  <span class="nx">Edit</span>
</span></span><span class="line"><span class="cl">                <span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick</span><span class="o">=</span><span class="p">{()</span> <span class="o">=&gt;</span> <span class="nx">handleDeleteUser</span><span class="p">(</span><span class="nx">user</span><span class="p">.</span><span class="nx">id</span><span class="p">)}&gt;</span>
</span></span><span class="line"><span class="cl">                  <span class="nx">Delete</span>
</span></span><span class="line"><span class="cl">                <span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">              <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="p">)}</span>
</span></span><span class="line"><span class="cl">          <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">))}</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="k">default</span> <span class="nx">Page</span><span class="p">;</span>
</span></span></code></pre></div><hr>
<p>4.2
上記のように修正したら<code>localhost:3000</code> にアクセスして動作確認します。</p>
<p>cssを書いていないのでとても簡素なものになっていますがユーザの作成、編集、削除を行うとそれが即座に反映されていたらwebsocketが動いているので成功になります。
<img src="https://hackmd.io/_uploads/Hy7-52Ym1e.png" alt="image (4)"></p>
<hr>
<h3 id="環境構築中に発生したエラーについて">環境構築中に発生したエラーについて</h3>
<p>自動生成したファイルの権限がrootになっていました。
その場合は以下のように権限を変更してあげてください。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">sudo chown -R <span class="o">{</span>name<span class="o">}</span>:<span class="o">{</span>name<span class="o">}</span> <span class="o">{</span>folder_name<span class="o">}</span>
</span></span><span class="line"><span class="cl">sudo chmod <span class="m">755</span> <span class="o">{</span>file_name<span class="o">}</span>
</span></span></code></pre></div><h2 id="余談">余談</h2>
<p>BINGOプロダクトをはじめて2年が経ちますがcode geneaterを導入したのは今年からでした。なのでせっかくなので導入前と後の比較を行い、自動生成は使うべきという教訓を皆様に共有します。</p>
<p>正直今もGraphql APIとREST APIの違いは分からずに使っていますが初期の頃はapi_methodsを作成していました。pageでは関数だけ呼び出して使いたいためここでPromiseの処理を書いたり、型定義をしたりと書いていました。</p>
<p>しかし、generaterを導入してからはクエリを定義するだけTSに必要な型定義やapollo clientによるカスタムフックが生成されるためせっかくAPIをhasuraが簡単に実装してくれるのにフロントエンドへの繋ぎ込みで時間がかかる問題を解決するに至りました。</p>
<p>導入前のAP
/src/utils/api_methods.ts</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">ApolloClient</span><span class="p">,</span> <span class="nx">InMemoryCache</span><span class="p">,</span> <span class="nx">gql</span><span class="p">}</span> <span class="kr">from</span> <span class="s2">&#34;@apollo/client&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="nx">next</span> <span class="kr">from</span> <span class="s2">&#34;next/types&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">GraphQLWsLink</span> <span class="p">}</span> <span class="kr">from</span> <span class="s1">&#39;@apollo/client/link/subscriptions&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">createClient</span> <span class="p">}</span> <span class="kr">from</span> <span class="s2">&#34;graphql-ws&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">userAgent</span> <span class="p">}</span> <span class="kr">from</span> <span class="s2">&#34;next/server&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">wsLink</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">GraphQLWsLink</span><span class="p">(</span><span class="nx">createClient</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">  <span class="nx">url</span>: <span class="kt">process.env.WS_API_URL</span> <span class="o">+</span> <span class="s2">&#34;/v1/graphql&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 認証関連はここに書く
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}));</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">client</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ApolloClient</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">  <span class="nx">link</span>: <span class="kt">wsLink</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">cache</span>: <span class="kt">new</span> <span class="nx">InMemoryCache</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="kr">interface</span> <span class="nx">BingoNumber</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">id</span>: <span class="kt">number</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">data</span>: <span class="kt">number</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// GraphQLクエリを実行
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">export</span> <span class="kr">async</span> <span class="kd">function</span> <span class="nx">getBingoNumber</span><span class="p">()</span><span class="o">:</span> <span class="nx">Promise</span><span class="p">&lt;</span><span class="nt">BingoNumber</span><span class="err">[]</span><span class="p">&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">client</span><span class="p">.</span><span class="nx">query</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">      <span class="nx">query</span>: <span class="kt">gql</span><span class="sb">`
</span></span></span><span class="line"><span class="cl"><span class="sb">        query MyQuery {
</span></span></span><span class="line"><span class="cl"><span class="sb">          bingo_number {
</span></span></span><span class="line"><span class="cl"><span class="sb">            data
</span></span></span><span class="line"><span class="cl"><span class="sb">            id
</span></span></span><span class="line"><span class="cl"><span class="sb">          }
</span></span></span><span class="line"><span class="cl"><span class="sb">        }
</span></span></span><span class="line"><span class="cl"><span class="sb">      `</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">bingo_number</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">&#34;Error fetching data:&#34;</span><span class="p">,</span> <span class="nx">error</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// websocket通信でBingoNumberを取得
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">export</span> <span class="kr">async</span> <span class="kd">function</span> <span class="nx">subscriptionBingoNumber</span><span class="p">()</span><span class="o">:</span> <span class="nx">Promise</span><span class="p">&lt;</span><span class="nt">BingoNumber</span><span class="err">[]</span><span class="p">&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">client</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">      <span class="nx">query</span>: <span class="kt">gql</span><span class="sb">`
</span></span></span><span class="line"><span class="cl"><span class="sb">        subscription MySubscription {
</span></span></span><span class="line"><span class="cl"><span class="sb">          bingo_number {
</span></span></span><span class="line"><span class="cl"><span class="sb">            data
</span></span></span><span class="line"><span class="cl"><span class="sb">            id
</span></span></span><span class="line"><span class="cl"><span class="sb">          }
</span></span></span><span class="line"><span class="cl"><span class="sb">        }
</span></span></span><span class="line"><span class="cl"><span class="sb">      `</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="k">new</span> <span class="nx">Promise</span><span class="p">&lt;</span><span class="nt">BingoNumber</span><span class="err">[]</span><span class="p">&gt;((</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">response</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">        <span class="nx">next</span>: <span class="kt">data</span> <span class="o">=&gt;</span> <span class="nx">resolve</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">bingo_number</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="nx">error</span>: <span class="kt">error</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">&#39;Subscription error:&#39;</span><span class="p">,</span> <span class="nx">error</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">          <span class="nx">reject</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">      <span class="p">});</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">&#39;Error fetching data:&#39;</span><span class="p">,</span> <span class="nx">error</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">[];</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="kr">async</span> <span class="kd">function</span> <span class="nx">createBingoNumber</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="nx">data</span>: <span class="kt">number</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span><span class="o">:</span> <span class="nx">Promise</span><span class="p">&lt;</span><span class="nt">BingoNumber</span><span class="err">[]</span><span class="p">&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">client</span><span class="p">.</span><span class="nx">mutate</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">      <span class="nx">mutation</span>: <span class="kt">gql</span><span class="sb">`
</span></span></span><span class="line"><span class="cl"><span class="sb">        mutation MyMutation($data: Int!) {
</span></span></span><span class="line"><span class="cl"><span class="sb">          insert_bingo_number_one(object: { data: $data }) {
</span></span></span><span class="line"><span class="cl"><span class="sb">            id
</span></span></span><span class="line"><span class="cl"><span class="sb">          }
</span></span></span><span class="line"><span class="cl"><span class="sb">        }
</span></span></span><span class="line"><span class="cl"><span class="sb">      `</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">variables</span><span class="o">:</span> <span class="p">{</span> <span class="nx">data</span> <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">insert_bingo_number_one</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">&#34;Error creating bingo number:&#34;</span><span class="p">,</span> <span class="nx">error</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="kr">async</span> <span class="kd">function</span> <span class="nx">deleteBingoNumber</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="nx">data</span>: <span class="kt">number</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span><span class="o">:</span> <span class="nx">Promise</span><span class="p">&lt;</span><span class="nt">BingoNumber</span><span class="err">[]</span><span class="p">&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">client</span><span class="p">.</span><span class="nx">mutate</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">      <span class="nx">mutation</span>: <span class="kt">gql</span><span class="sb">`
</span></span></span><span class="line"><span class="cl"><span class="sb">        mutation MyMutation($data: Int!) {
</span></span></span><span class="line"><span class="cl"><span class="sb">          delete_bingo_number(where: { data: { _eq: $data } }) {
</span></span></span><span class="line"><span class="cl"><span class="sb">            affected_rows
</span></span></span><span class="line"><span class="cl"><span class="sb">          }
</span></span></span><span class="line"><span class="cl"><span class="sb">        }
</span></span></span><span class="line"><span class="cl"><span class="sb">      `</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">variables</span><span class="o">:</span> <span class="p">{</span> <span class="nx">data</span> <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">delete_bingo_number</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">&#34;Error deleteing bingo number:&#34;</span><span class="p">,</span> <span class="nx">error</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>導入後のAPI
src/gql/numbers.gql</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-gql" data-lang="gql"><span class="line"><span class="cl"><span class="c"># 番号の取得(Get)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">query</span><span class="w"> </span><span class="nc">GetListNumbers</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="py">numbers</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="py">id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="py">number</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="py">createdAt</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="py">updatedAt</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># 番号の追加(Create)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">mutation</span><span class="w"> </span><span class="nc">CreateOneNumber</span><span class="p">(</span><span class="nv">$number</span><span class="p">:</span><span class="w"> </span><span class="nc">Int</span><span class="p">!)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="py">insertNumbersOne</span><span class="p">(</span><span class="py">object</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nc">number</span><span class="p">:</span><span class="w"> </span><span class="nv">$number</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nc">id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># 番号の削除(Delete)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">mutation</span><span class="w"> </span><span class="nc">DeleteOneNumber</span><span class="p">(</span><span class="nv">$number</span><span class="p">:</span><span class="w"> </span><span class="nc">Int</span><span class="p">!)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="py">deleteNumbers</span><span class="p">(</span><span class="py">where</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nc">number</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nc">_eq</span><span class="p">:</span><span class="w"> </span><span class="nv">$number</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nc">affectedRows</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># 番号の継続取得(Subscription)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">subscription</span><span class="w"> </span><span class="nc">SubscribeListNumbers</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="py">numbers</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="py">id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="py">number</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="py">createdAt</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="py">updatedAt</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><h2 id="おわりに">おわりに</h2>
<p>ここまでご一読いただきありがとうございました。誰かの開発のヒントになっていれば幸いです。</p>
<p>私事になりますが、NUTMEGは今年も多くの新入生に恵まれ活気のある団体になりました。他局との信頼関係も一層強まりヒアリングに対して真摯に対応してくださるおかげで沢山の修正事項や改善事項を頂きました。今の新入生の勢いに負けないように寄りよりプロダクトを実現・提供できるように活動していきたいと思います。</p>
<p>最後に言いたかったこととして、皆さん是非Generaterによる自動生成をうまく活用して良い開発ライフをお送りください。今の時代、活用したもの勝ちです。</p>

        </div>

        
        
      </div>
    </div>
  </div>
</section>



<footer>
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-12 text-center mb-5">
        <a href="https://blog.nutmeg.cloud/"><img src="https://blog.nutmeg.cloud/images/NUTMEG-logo_all_color_horizontal.png" alt="NUTMEG | 長岡技術科学大学 技大祭実行委員会 情報局"></a>
      </div>
      
      <div class="col-lg-3 col-sm-6 mb-5">
        <h6 class="mb-4">Social Contacts</h6>
        <ul class="list-unstyled">
          
          <li class="mb-3"><a class="text-dark" href="https://twitter.com/nutfes_nutmeg">twitter</a></li>
          
          <li class="mb-3"><a class="text-dark" href="https://www.instagram.com/nutfes/?hl=ja">instagram</a></li>
          
          <li class="mb-3"><a class="text-dark" href="https://github.com/orgs/NUTFes">github</a></li>
          
        </ul>
      </div>
      <div class="col-lg-3 col-sm-6 mb-5">
        <h6 class="mb-4">Categories</h6>
        <ul class="list-unstyled">
          <li class="mb-3"><a class="text-dark"
              href="https://blog.nutmeg.cloud/categories/nutmeg-advent-calendar-2023">Nutmeg advent calendar 2023</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="https://blog.nutmeg.cloud/categories/nutmeg-advent-calendar-2024">Nutmeg advent calendar 2024</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="https://blog.nutmeg.cloud/categories/%e3%82%a4%e3%83%99%e3%83%b3%e3%83%88">イベント</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="https://blog.nutmeg.cloud/categories/%e3%83%81%e3%83%bc%e3%83%a0%e3%81%a5%e3%81%8f%e3%82%8a">チームづくり</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="https://blog.nutmeg.cloud/categories/%e3%83%a1%e3%83%b3%e3%83%90%e3%83%bc%e3%81%ae%e8%b6%a3%e5%91%b3">メンバーの趣味</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="https://blog.nutmeg.cloud/categories/%e5%af%be%e5%a4%96%e6%b4%bb%e5%8b%95">対外活動</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="https://blog.nutmeg.cloud/categories/%e6%b4%bb%e5%8b%95%e3%81%ae%e6%a7%98%e5%ad%90">活動の様子</a>
          </li>
        </ul>
      </div>
      <div class="col-lg-3 col-sm-6 mb-5">
        <h6 class="mb-4">Quick Links</h6>
        <ul class="list-unstyled">
          
          <li class="mb-3"><a class="text-dark" href="https://blog.nutmeg.cloud/about">About</a></li>
          
          <li class="mb-3"><a class="text-dark" href="https://blog.nutmeg.cloud/blog">Post</a></li>
          
          <li class="mb-3"><a class="text-dark" href="https://blog.nutmeg.cloud/products">Products</a></li>
          
          <li class="mb-3"><a class="text-dark" href="https://blog.nutmeg.cloud/members">Members</a></li>
          
        </ul>
      </div>
      <div class="col-12 border-top py-4 text-center">
        © NUTMEG 2024
      </div>
    </div>
  </div>
</footer>

<script>
  var indexURL = "https://blog.nutmeg.cloud/index.json"
</script>

<!-- JS Plugins -->

<script src="https://blog.nutmeg.cloud/plugins/jQuery/jquery.min.js"></script>

<script src="https://blog.nutmeg.cloud/plugins/bootstrap/bootstrap.min.js"></script>

<script src="https://blog.nutmeg.cloud/plugins/slick/slick.min.js"></script>

<script src="https://blog.nutmeg.cloud/plugins/venobox/venobox.min.js"></script>

<script src="https://blog.nutmeg.cloud/plugins/search/fuse.min.js"></script>

<script src="https://blog.nutmeg.cloud/plugins/search/mark.js"></script>

<script src="https://blog.nutmeg.cloud/plugins/search/search.js"></script>

<!-- Main Script -->

<script src="https://blog.nutmeg.cloud/js/script.min.js"></script>


<script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
<script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>


</body>
</html>